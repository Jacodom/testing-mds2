# üöÄ Gu√≠a Completa de Test-Driven Development (TDD)

## üìö √çndice

1. [¬øQu√© es TDD?](#qu√©-es-tdd)
2. [El Ciclo Red-Green-Refactor](#el-ciclo-red-green-refactor)
3. [Beneficios del TDD](#beneficios-del-tdd)
4. [Configuraci√≥n del Proyecto](#configuraci√≥n-del-proyecto)
5. [Ejercicios Pr√°cticos](#ejercicios-pr√°cticos)
6. [Ejemplos Avanzados](#ejemplos-avanzados)
7. [Mejores Pr√°cticas](#mejores-pr√°cticas)
8. [Errores Comunes](#errores-comunes)

---

## ¬øQu√© es TDD?

**Test-Driven Development (TDD)** es una metodolog√≠a de desarrollo de software donde **escribes las pruebas ANTES que el c√≥digo de producci√≥n**.

### üéØ Principio Fundamental

> "No escribas c√≥digo de producci√≥n hasta que tengas un test fallando que lo requiera"

### üìñ Filosof√≠a

TDD no es solo sobre testing, es sobre **dise√±o**. Los tests act√∫an como:

- üìã **Especificaci√≥n**: Definen qu√© debe hacer el c√≥digo
- üèóÔ∏è **Dise√±o**: Te fuerzan a pensar en la API antes de implementar
- üìñ **Documentaci√≥n**: Los tests son documentaci√≥n ejecutable
- üõ°Ô∏è **Red de seguridad**: Te permiten refactorizar con confianza

---

## El Ciclo Red-Green-Refactor

TDD sigue un ciclo de 3 pasos que se repite constantemente:

### üî¥ 1. RED (Falla)

```typescript
// ‚ùå Escribes un test que falla (porque no existe el c√≥digo)
it("should calculate area of rectangle", () => {
  const result = calculateRectangleArea(5, 3);
  expect(result).toBe(15);
});
```

### üü¢ 2. GREEN (Pasa)

```typescript
// ‚úÖ Escribes el M√çNIMO c√≥digo para que pase
function calculateRectangleArea(width: number, height: number): number {
  return width * height; // Implementaci√≥n m√≠nima
}
```

### üîµ 3. REFACTOR (Mejora)

```typescript
// üîÑ Mejoras el c√≥digo manteniendo los tests verdes
function calculateRectangleArea(width: number, height: number): number {
  if (width <= 0 || height <= 0) {
    throw new Error("Width and height must be positive");
  }
  return width * height;
}
```

### ‚è±Ô∏è Ciclo Completo

1. **RED** (30 segundos - 2 minutos): Escribe un test que falle
2. **GREEN** (30 segundos - 2 minutos): Hazlo pasar con el m√≠nimo c√≥digo
3. **REFACTOR** (2-5 minutos): Mejora el dise√±o sin romper tests
4. **Repetir** hasta completar la funcionalidad

---

## Beneficios del TDD

### üéØ Para el C√≥digo

- **Mejor dise√±o**: APIs m√°s limpias y desacopladas
- **Menos bugs**: Los defectos se detectan inmediatamente
- **Cobertura alta**: Naturalmente obtienes ~100% de cobertura
- **Documentaci√≥n viva**: Los tests explican c√≥mo usar el c√≥digo

### üë®‚Äçüíª Para el Desarrollador

- **Confianza**: Puedes refactorizar sin miedo
- **Enfoque**: Una cosa a la vez, paso a paso
- **Feedback r√°pido**: Sabes inmediatamente si algo se rompe
- **Menos debugging**: Encuentras problemas antes

### üè¢ Para el Proyecto

- **Mantenibilidad**: Cambios seguros en el futuro
- **Velocidad**: Menos tiempo debuggeando, m√°s desarrollando
- **Calidad**: C√≥digo m√°s robusto y confiable

---

## Configuraci√≥n del Proyecto

Este proyecto ya est√° configurado con:

### üõ†Ô∏è Stack Tecnol√≥gico

- **TypeScript**: Lenguaje principal
- **Jest**: Framework de testing unitario
- **Playwright**: Testing de integraci√≥n/E2E
- **Express**: Servidor web para APIs
- **Allure**: Reportes de testing avanzados

### üì¶ Comandos Disponibles

```bash
# Unit tests con TDD
npm run test:watch    # Ejecuta tests en modo watch (ideal para TDD)
npm run test:unit     # Ejecuta unit tests una vez
npm run coverage      # Genera reporte de cobertura

# Integration tests
npm run test:integration  # Tests de integraci√≥n
npm run test:all         # Todos los tests

# Reportes
npm run report          # Genera y abre reporte Allure
```

### üîß Configuraci√≥n para TDD

Para una experiencia √≥ptima de TDD, ejecuta:

```bash
npm run test:watch
```

Esto mantendr√° los tests ejecut√°ndose autom√°ticamente cada vez que cambies c√≥digo.

---

## Ejercicios Pr√°cticos

### üéì Nivel 1: Funciones Simples

#### Ejercicio 1.1: Calculadora

**Objetivo**: Crear una calculadora b√°sica usando TDD

**Pasos**:

1. Crea `src/utils/calculator.ts` (vac√≠o)
2. Crea `tests/unit/calculator.test.ts`
3. Sigue el ciclo RED-GREEN-REFACTOR para cada operaci√≥n

```typescript
// tests/unit/calculator.test.ts
describe("Calculator", () => {
  describe("add", () => {
    it("should add two positive numbers", () => {
      const result = add(2, 3);
      expect(result).toBe(5);
    });

    // ‚ùå Este test fallar√° inicialmente
  });
});
```

**Funcionalidades a implementar**:

- ‚úÖ Suma de n√∫meros positivos
- ‚úÖ Suma con n√∫meros negativos
- ‚úÖ Suma con cero
- ‚úÖ Resta, multiplicaci√≥n, divisi√≥n
- ‚úÖ Divisi√≥n por cero (debe lanzar error)

#### Ejercicio 1.2: Validador de Email

**Objetivo**: Validar emails usando TDD

```typescript
// Casos a considerar:
// ‚úÖ Emails v√°lidos: "user@domain.com"
// ‚ùå Sin @: "userdomain.com"
// ‚ùå Sin dominio: "user@"
// ‚ùå Vac√≠o: ""
// ‚ùå Solo espacios: "   "
```

### üéì Nivel 2: Clases y Objetos

#### Ejercicio 2.1: Clase BankAccount

**Objetivo**: Crear una cuenta bancaria con TDD

```typescript
// Funcionalidades:
// - Constructor con balance inicial
// - deposit(amount): agregar dinero
// - withdraw(amount): retirar dinero
// - getBalance(): obtener balance
// - Validaciones: no permitir montos negativos, no sobregiro
```

#### Ejercicio 2.2: Sistema de Inventario

**Objetivo**: Gestionar productos en inventario

```typescript
// Funcionalidades:
// - addProduct(product): agregar producto
// - removeProduct(id): remover producto
// - updateStock(id, quantity): actualizar stock
// - findProduct(id): buscar producto
// - getProductsWithLowStock(threshold): productos con poco stock
```

### üéì Nivel 3: Servicios con Dependencias

#### Ejercicio 3.1: UserService con TDD

**Objetivo**: Implementar un nuevo servicio usando TDD puro

**Escenario**: Vas a crear un `NotificationService` desde cero:

```typescript
// tests/unit/notification.service.test.ts
describe("NotificationService", () => {
  let notificationService: NotificationService;
  let mockEmailProvider: jest.Mocked<EmailProvider>;
  let mockSMSProvider: jest.Mocked<SMSProvider>;

  beforeEach(() => {
    // Setup mocks
    mockEmailProvider = {
      sendEmail: jest.fn(),
    };
    mockSMSProvider = {
      sendSMS: jest.fn(),
    };

    notificationService = new NotificationService(
      mockEmailProvider,
      mockSMSProvider
    );
  });

  describe("sendWelcomeNotification", () => {
    it("should send welcome email for email preference", async () => {
      // ‚ùå RED: Este test fallar√° porque no existe el c√≥digo
      const user = { id: "1", email: "user@test.com", preference: "email" };

      await notificationService.sendWelcomeNotification(user);

      expect(mockEmailProvider.sendEmail).toHaveBeenCalledWith({
        to: "user@test.com",
        subject: "Bienvenido",
        body: expect.stringContaining("Bienvenido"),
      });
    });
  });
});
```

**Tu tarea**: Implementar paso a paso siguiendo TDD.

---

## Ejemplos Avanzados

### üèóÔ∏è TDD con Arquitectura Hexagonal

En este proyecto, puedes ver c√≥mo TDD funciona con arquitecturas m√°s complejas:

#### Ejemplo: UserService Existente

El `UserService` ya implementado muestra:

```typescript
// src/services/user.service.ts
export class UserService {
  constructor(private userRepository: UserRepository) {}

  async createUser(userData: CreateUserRequest): Promise<User> {
    // L√≥gica de negocio testeada unitariamente
    if (!this.isValidEmail(userData.email)) {
      throw new Error("Email inv√°lido");
    }

    // ... m√°s validaciones

    return await this.userRepository.create(userData);
  }
}
```

#### Tests Unitarios del UserService

```typescript
// tests/unit/user.service.test.ts
describe("UserService", () => {
  let userService: UserService;
  let mockUserRepository: jest.Mocked<UserRepository>;

  beforeEach(() => {
    mockUserRepository = {
      create: jest.fn(),
      findByEmail: jest.fn(),
      // ... otros m√©todos
    };

    userService = new UserService(mockUserRepository);
  });

  it("deber√≠a crear un usuario con datos v√°lidos", async () => {
    // Arrange
    mockUserRepository.findByEmail.mockResolvedValue(null);
    mockUserRepository.create.mockResolvedValue(expectedUser);

    // Act
    const result = await userService.createUser(validUserData);

    // Assert
    expect(result).toEqual(expectedUser);
    expect(mockUserRepository.create).toHaveBeenCalledWith(validUserData);
  });
});
```

### üéØ TDD en el Mundo Real

#### Patr√≥n: Outside-In TDD

1. **Empezar por el test de integraci√≥n** (lo que el usuario ve)
2. **Dejar que el test de integraci√≥n gu√≠e** los tests unitarios
3. **Implementar de afuera hacia adentro**

```typescript
// 1. Test de integraci√≥n (Playwright)
test("should create user via API", async ({ request }) => {
  const response = await request.post("/api/users", {
    data: { name: "Juan", email: "juan@test.com", age: 25 },
  });

  expect(response.status()).toBe(201);
  // ‚ùå Falla porque no existe el endpoint
});

// 2. Esto nos lleva a crear el controller test
describe("UserController", () => {
  it("should create user successfully", async () => {
    // Test del controller
    // ‚ùå Falla porque no existe UserController.createUser
  });
});

// 3. Que nos lleva al service test
describe("UserService", () => {
  it("should create user with validation", async () => {
    // Test del service
    // ‚ùå Falla porque no existe UserService.createUser
  });
});
```

---

## Mejores Pr√°cticas

### ‚úÖ DO (Hacer)

#### 1. **Tests Peque√±os y Enfocados**

```typescript
// ‚úÖ BIEN: Un test, una responsabilidad
it("should reject negative age", async () => {
  await expect(userService.createUser({ age: -1 })).rejects.toThrow(
    "Edad debe estar entre 0 y 120 a√±os"
  );
});

// ‚ùå MAL: Un test que hace muchas cosas
it("should validate user data", async () => {
  // Testea email, age, name, etc. todo junto
});
```

#### 2. **Arrange-Act-Assert (AAA)**

```typescript
it("should calculate total with tax", () => {
  // Arrange
  const price = 100;
  const taxRate = 0.1;

  // Act
  const result = calculateTotalWithTax(price, taxRate);

  // Assert
  expect(result).toBe(110);
});
```

#### 3. **Nombres Descriptivos**

```typescript
// ‚úÖ BIEN: Describe el comportamiento
it("should throw error when email is already in use", () => {});

// ‚ùå MAL: No dice qu√© esperar
it("should test email validation", () => {});
```

#### 4. **Tests Independientes**

```typescript
// ‚úÖ BIEN: Cada test se configura a s√≠ mismo
beforeEach(() => {
  userService = new UserService(mockRepository);
});

// ‚ùå MAL: Tests dependen de orden de ejecuci√≥n
let globalUser; // ‚ùå Estado compartido
```

### ‚ùå DON'T (No Hacer)

#### 1. **No Testear Implementaci√≥n**

```typescript
// ‚ùå MAL: Testea c√≥mo se hace
it("should call repository.create with correct params", () => {
  userService.createUser(userData);
  expect(mockRepository.create).toHaveBeenCalledWith(userData);
});

// ‚úÖ BIEN: Testea qu√© se logra
it("should return created user with generated id", async () => {
  const result = await userService.createUser(userData);
  expect(result).toHaveProperty("id");
  expect(result.name).toBe(userData.name);
});
```

#### 2. **No Saltarse el RED**

```typescript
// ‚ùå MAL: Escribir test y c√≥digo al mismo tiempo
// ‚úÖ BIEN: Siempre ver el test fallar primero
```

#### 3. **No Tests Demasiado Complejos**

```typescript
// ‚ùå MAL: Test con l√≥gica complicada
it("should handle complex scenario", () => {
  for (let i = 0; i < 10; i++) {
    if (i % 2 === 0) {
      // l√≥gica compleja en el test
    }
  }
});
```

### üéØ Consejos para TDD

#### 1. **Empieza Simple**

```typescript
// Primer test: caso m√°s simple posible
it("should return empty array when no users exist", () => {
  const result = userService.getAllUsers();
  expect(result).toEqual([]);
});
```

#### 2. **Baby Steps**

- Un test a la vez
- Incrementos peque√±os
- No implementes m√°s de lo que el test requiere

#### 3. **Refactoriza Constantemente**

- Despu√©s de cada GREEN, preg√∫ntate: "¬øPuedo mejorarlo?"
- Elimina duplicaci√≥n
- Mejora nombres
- Simplifica l√≥gica

#### 4. **Mant√©n los Tests R√°pidos**

```typescript
// ‚úÖ Unit tests deben ser < 100ms
// ‚úÖ Suite completa < 10 segundos para TDD efectivo
```

---

## Errores Comunes

### üö® Error 1: Saltarse la Fase RED

**Problema**: Escribir test y c√≥digo que pasa inmediatamente

**S√≠ntoma**:

```typescript
// ‚ùå Test que nunca falla
it("should return true", () => {
  expect(true).toBe(true); // Siempre pasa
});
```

**Soluci√≥n**: Siempre ver el test fallar primero

### üö® Error 2: Tests Demasiado Grandes

**Problema**: Un test que verifica muchas cosas

**S√≠ntoma**:

```typescript
// ‚ùå Test gigante
it("should handle user lifecycle", async () => {
  // 50 l√≠neas de c√≥digo testando creaci√≥n, actualizaci√≥n, eliminaci√≥n
});
```

**Soluci√≥n**: Un test por comportamiento

### üö® Error 3: No Refactorizar

**Problema**: Quedarse en GREEN sin mejorar el c√≥digo

**S√≠ntoma**:

```typescript
// ‚úÖ Funciona pero est√° duplicado
function validateEmail(email: string): boolean {
  if (email.includes("@") && email.includes(".")) return true;
  return false;
}

function validateStrongEmail(email: string): boolean {
  if (email.includes("@") && email.includes(".")) return true; // Duplicado
  return false;
}
```

**Soluci√≥n**: Siempre refactorizar despu√©s de GREEN

### üö® Error 4: Mocks Demasiado Espec√≠ficos

**Problema**: Tests fr√°giles que se rompen con cambios menores

**S√≠ntoma**:

```typescript
// ‚ùå Muy espec√≠fico
expect(mockService.method).toHaveBeenCalledWith(
  exactly, these, parameters, in, this, order
);
```

**Soluci√≥n**: Mockear solo lo necesario

### üö® Error 5: Testing de Implementaci√≥n vs Comportamiento

**Problema**: Testear c√≥mo funciona en lugar de qu√© hace

**S√≠ntoma**:

```typescript
// ‚ùå Testa implementaci√≥n
it("should call validateEmail and then save", () => {
  userService.createUser(userData);
  expect(userService.validateEmail).toHaveBeenCalled();
  expect(repository.save).toHaveBeenCalled();
});

// ‚úÖ Testa comportamiento
it("should create user with valid email", async () => {
  const result = await userService.createUser(validUserData);
  expect(result).toHaveProperty("id");
});
```

---

## üéì Ejercicios de Pr√°ctica

### Ejercicio Final: Biblioteca TDD

**Objetivo**: Implementar un sistema de biblioteca completo usando TDD

#### Requisitos:

1. **Book Management**

   - Agregar/quitar libros
   - Buscar por t√≠tulo/autor
   - Categorizar libros

2. **User Management**

   - Registrar usuarios
   - Validar informaci√≥n
   - Tipos de usuario (estudiante, profesor)

3. **Lending System**
   - Prestar libros
   - Devolver libros
   - Calcular multas por retraso
   - L√≠mites por tipo de usuario

#### Estructura Sugerida:

```
src/
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ book.model.ts
‚îÇ   ‚îú‚îÄ‚îÄ user.model.ts
‚îÇ   ‚îî‚îÄ‚îÄ lending.model.ts
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ book.service.ts
‚îÇ   ‚îú‚îÄ‚îÄ user.service.ts
‚îÇ   ‚îî‚îÄ‚îÄ lending.service.ts
‚îî‚îÄ‚îÄ repositories/
    ‚îú‚îÄ‚îÄ book.repository.ts
    ‚îú‚îÄ‚îÄ user.repository.ts
    ‚îî‚îÄ‚îÄ lending.repository.ts

tests/unit/
‚îú‚îÄ‚îÄ book.service.test.ts
‚îú‚îÄ‚îÄ user.service.test.ts
‚îî‚îÄ‚îÄ lending.service.test.ts
```

#### Pasos a Seguir:

1. **Empezar con BookService**

   - Test para agregar libro
   - Test para buscar libro
   - Test para validaciones

2. **Continuar con UserService**

   - Test para registro
   - Test para validaciones
   - Test para tipos de usuario

3. **Finalizar con LendingService**
   - Test para pr√©stamo
   - Test para devoluci√≥n
   - Test para c√°lculo de multas

---

## üìö Recursos Adicionales

### üìñ Libros Recomendados

- **"Test Driven Development: By Example"** - Kent Beck
- **"Growing Object-Oriented Software, Guided by Tests"** - Steve Freeman & Nat Pryce
- **"The Art of Unit Testing"** - Roy Osherove

### üîó Enlaces √ötiles

- [Jest Documentation](https://jestjs.io/docs/getting-started)
- [Playwright Testing](https://playwright.dev/docs/test-intro)
- [TDD Wikipedia](https://en.wikipedia.org/wiki/Test-driven_development)

### üé• Videos y Tutoriales

- Buscar: "TDD TypeScript tutorial"
- Buscar: "Jest TDD examples"
- Buscar: "Kent Beck TDD demonstration"

---

## üéØ Conclusi√≥n

TDD es m√°s que una t√©cnica de testing, es una **metodolog√≠a de dise√±o** que te ayuda a:

- üéØ **Escribir c√≥digo m√°s limpio**
- üõ°Ô∏è **Tener confianza para refactorizar**
- üìà **Mejorar la calidad del software**
- ‚ö° **Desarrollar m√°s r√°pido a largo plazo**

### üöÄ Pr√≥ximos Pasos

1. **Practica con ejercicios simples**
2. **Mant√©n el ciclo RED-GREEN-REFACTOR**
3. **Incrementa gradualmente la complejidad**
4. **Aplica TDD en proyectos reales**

### üí° Recuerda

> "TDD no es sobre escribir tests. Es sobre dise√±ar mejor software a trav√©s de tests."

¬°Empieza con el ejercicio de la calculadora y ve construyendo tu confianza en TDD paso a paso! üöÄ

---

_Esta gu√≠a est√° dise√±ada para ser pr√°ctica y progresiva. Cada concepto se construye sobre el anterior, permitiendo un aprendizaje s√≥lido de TDD._

¬øTienes preguntas? ¬°Experimenta con los ejercicios y descubre TDD por ti mismo! üí™
